egl.defineWidget("dojo.widgets","DojoTree","dojo.widgets","DojoContainer","div",{"constructor":function(){this.setChildType("dojo.widgets.DojoTreeNode");this.eglNodes={};this.showRoot=true;this.requireList=["dijit/Tree","dojo/data/ItemFileWriteStore"];this.renderWhenDojoIsDoneLoading(this.requireList);},"createDojoWidget":function(_1){if(!this.model){this.setModel();}var _2=this;this.dojoID="egl.DojoTree"+(++egl._dojoSerial);this._mergeArgs({id:this.id||this.dojoID,model:this.model,showRoot:this.showRoot,_createTreeNode:function(_3){var _4=_2.eglNodes[_3.item.id];var _5;if(_4&&_3.item&&!_3.item.root){if(_4.dojoWidget){return _4.dojoWidget;}var _6=_4.eze$$DOMElement.style;_4._mergeArgs(_3);_4._args.getParent=function(){var _7=this.domNode?dijit.getEnclosingWidget(this.domNode.parentNode):null;return _7&&_7.isContainer?_7:null;};_5=new dijit._TreeNode(_4._args);_4.dojoWidget=_5;_5.set("id",_4.id);_4.render();_4.copyStyle(_6);}else{if(!_3.item.root){egl.printError("DojoTree \""+child.id+"\" Cannot create.");}else{_5=new dijit._TreeNode(_3);}}return _5;}});this._args.onClick=function(_8,_9,e){_2.selection=_8.id&&_8.id.length>0?_8.id[0]:_2.id;_2.handleEvent(_2.getOnClick(),"onClick",e);var _a=_9.domNode.eze$$widget;if(_a&&_a.onClick){_a.handleEvent(_a.getOnClick(),"onClick",e);}};if(this.getWidgetOrientation()){this._args.dir=this.getWidgetOrientation();}this.dojoWidget=new dijit.Tree(this._args,_1);if(this.textLayoutThis||this.reverseTextDirectionThis){this.applyBiDiMarkersToWidgetText();this.dojoWidget.rootNode.labelNode.innerHTML=this.text;egl.dojo.widgets.DojoContainer.prototype.setBiDiMarkers.call(this);}setTimeout(egl.startVEWidgetTimer,2000);this.dojoWidget.startup();},"setModel":function(){this.storeData={identifier:"id",label:"text",items:this.getModelData()};this.store=new dojo.data.ItemFileWriteStore({data:this.storeData});this.model=new dijit.tree.ForestStoreModel({store:this.store,rootLabel:this.text});},"setChildren":function(_b){egl.eglx.ui.rui.Widget.prototype.removeChildren.call(this);this.children=_b;if(dojo&&dojo.data){this.setModel();}this.renderWhenDojoIsDoneLoading(this.requireList);},"removeChildren":function(){this.setChildren([]);},"appendChild":function(_c){if(_c){_c.parent=this;_c.setTree(this);var _d=this;this.store.fetchItemByIdentity({identity:_d.id,onItem:function(_e){try{_d.model.newItem(_c.getItemOnly(),_e);_d.store.save();}catch(e){egl.printError("Cannot add TreeNode \""+_c.id+"\" to \""+_d.id+"\". Duplicate node is not allowed.",e);}},onFail:function(){egl.printError("Cannot add TreeNode \""+_c.id+"\" to \""+_d.id+"\". Duplicate node is not allowed.");}});this.children.appendElement(_c);if(_c.children&&_c.children.length){for(var i=0;i<_c.children.length;i++){var _f=_c.children[i];_c.appendChild(_f);}}}},"getIndex":function(_10){if(this.children){for(var i=0;i<this.children.length;i++){if(_10.id==this.children[i].id){return i+1;}}return -1;}},"removeChild":function(_11){if(_11){if(_11.children&&_11.children.length>0){var _12=_11.children.length;for(var i=_12-1;i>=0;i--){var _13=_11.children[i];_11.removeChild(_13,_11.getIndex(_13));}}this.children.removeElement(this.getIndex(_11));var _14=this;this.store.fetchItemByIdentity({identity:_11.id,onItem:function(_15){try{_14.store.deleteItem(_15);_14.store.save();}catch(e){e.message="Cannot remove DojoTreeNode \""+_11.id+"\" from \""+_14.id+"\"";egl.printError("Invalid argument to DojoTreeNode.removeChild",e);}}});}},"getElementById":function(id){var _16=null;this.store.fetchItemByIdentity({identity:id,onItem:function(_17){_16=_17;}});if(_16){return this.eglNodes[id];}return null;},"getModelData":function(){var _18=[];for(var n=0;n<this.children.length;n++){var _19=this.children[n];_19.setTree(this);_18.push(_19.getItem());}return _18;},"setText":function(_1a){this.text=_1a;this.applyBiDiMarkersToWidgetText();if(this.dojoWidget){this.model.rootLabel=_1a;this.dojoWidget.rootNode.set("label",_1a);}},"getShowRoot":function(_1b){return this.showRoot;},"setShowRoot":function(_1c){this.showRoot=_1c;if(this.dojoWidget){this.render();}}});