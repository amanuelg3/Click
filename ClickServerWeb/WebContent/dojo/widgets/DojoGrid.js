egl.defineWidget("dojo.widgets","DojoGrid","dojo.widgets","DojoBase","div",{"constructor":function(){this.headerBehaviors=[];this.behaviors=[];this.data=[];},"createDojoWidget":function(_1){this.setInnerHTML("");var _2=this;this.dojoColumns=this.createColumns();this.dojoStore=new dojo.data.ItemFileWriteStore({data:this.createData(this.data,this.dojoColumns)});this._mergeArgs({id:_2.id,structure:_2.dojoColumns,store:_2.dojoStore,autoHeight:true,autoWidth:true,splitter:false});this.dojoWidget=new dojox.grid.DataGrid(this._args,_1);var _3=function(){setTimeout(function(){_2.runBehaviors();},1);};this.dojoWidget.domNode.setAttribute("align","left");this.dojoWidget.connect(this.dojoWidget,"postrender",_3);this.dojoWidget.render();this.dojoWidget.startup();this.dojoWidget.resize({w:this.width,h:this.height});},"setData":function(_4){if(!_4){_4=[];}egl.dojo.widgets.DojoBase.prototype.setData.call(this,_4,["dojox/grid/DataGrid","dojo/data/ItemFileWriteStore"]);},"getData":function(){var _5=this.dojoWidget.getSortIndex();if(-1!=_5&&_5<this.columns.length&&_5>-1){var _6=!this.dojoWidget.getSortAsc();var _7=this.columns[_5].name;var _8=this;this.dojoStore.fetch({onComplete:function(_9,_a){if(_9&&_9.length>0&&_8.data&&_8.data.length>0){for(var i=0;i<_9.length;i++){for(var _b=0;_b<_8.columns.length;_b++){egl.unboxAny(_8.data[i])[_8.columns[_b].name]=_9[i][_8.columns[_b].name][0];}}}},sort:[{attribute:_7,descending:_6}]});}return this.data;},"runBehaviors":function(){this.addBehaviors(this.behaviors,"td",this.data.length);this.addBehaviors(this.headerBehaviors,"th",1);this.fixSizes();},"fixSizes":function(){var _c=this.dojoWidget.domNode.getElementsByTagName("tbody");var w=0,h=0,_d;for(var n=1;n<_c.length;n++){if(_c[n].className!="EglRuiTbody"){h+=egl.getHeightInPixels(_c[n])+1;w=Math.max(w,egl.getWidthInPixels(_c[n])+1);}}var _d=egl.getHeightInPixels(_c[0]);w=this.width?parseInt(this.width):w;h=this.height?parseInt(this.height)-_d:h;var _e=this.dojoWidget.domNode.getElementsByTagName("div");if(!this.width||!this.height){for(var n=0;n<_e.length;n++){var _f=_e[n];if(this.isGridDiv(_f.className)){if(!this.height){_f.style.height=egl.toPX(h);}if(!this.width){_f.style.width=egl.toPX(w);}}if("dojoxGridHeader"==_f.className){_f.style.width=egl.toPX(w);}}}egl.setWidth(this.eze$$DOMElement,egl.toPX(w));egl.setHeight(this.eze$$DOMElement,egl.toPX(h+_d));},"setHeight":function(_10){this.height=_10;if(this.dojoWidget){this.dojoWidget.resize({h:this.height});}},"getHeight":function(){return this.height;},"setWidth":function(_11){this.width=_11;if(this.dojoWidget){this.dojoWidget.resize({h:this.width});}},"getWidth":function(){return this.width;},"isGridDiv":function(_12){switch(_12){case "dojoxGrid-master-view":case "dojoxGridMasterView":case "dojoxGrid":case "dojoxGrid-view":case "dojoxGridView":case "dojoxGrid-content":case "dojoxGridContent":case "dojoxGrid-scrollbox":case "dojoxGridScrollbox":return true;}return false;},"showError":function(w,h){var s="This is an empty DojoGrid. Nothing was rendered.";if(this.data.length>0){s+="<p>There are "+this.data.length+" records and "+this.columns.length+" columns.";s+="<p>Columns:";var _13=null;var _14=this.data.length>0?this.data[0]:{};for(var n=0;n<this.dojoColumns.length;n++){s+=" "+n+":\""+this.dojoColumns[n].field+"\"";if(!(this.dojoColumns[n].field in _14)){_13=_13||this.dojoColumns[n].field;}}s+="<p>Data: ["+this.data.length+"] {";for(f in _14){if(egl.isUserField(_14,f)){s+=" \""+f+"\"";}}s+="}";s+="<p>Grid width = "+w+". Grid height = "+h;if(_13){s+="<br>Check your column definitions. Missing data field: "+_13;}else{s+="<p><b>Internal Error</b>. This appears to be a race condition. "+"Please report this problem to the proper authorities.<br>"+"Browser: "+window.navigator.userAgent;}}this.setWidth(600);this.setHeight(400);this.setInnerHTML(s);egl.setEnableTextSelection(true);},"createData":function(_15,_16){var _17={identifier:"",label:"",items:[{}]};var _18=5;var _19=_15.length>0?_15.length:5;for(var row=0;row<_19;row++){_17.items[row]={};for(var _1a=0;_1a<_16.length;_1a++){var _1b;if(_15.length<=0){_1b="";}else{_1b=egl.unboxAny(egl.unboxAny(_15[row])[_16[_1a].field]);if(_1b===undefined){_1b="";}}var _1c=_16[_1a].field;_17.items[row][_1c]=_1b;}}return _17;},"createColumns":function(){this.columns=this.columns||[];var _1d=this;var _1e=[];if(!this.columns.length&&this.data.length){var _1f=egl.unboxAny(this.data[0]);for(f in _1f){if(egl.isUserField(_1f,f)){_1e.push({name:f,field:f});}}this.columns=_1e;}else{for(var n=0;n<this.columns.length;n++){var _20=this.columns[n];var _21=_20.displayName||_20.name;_21=_21.replace(/ /g,"&nbsp;");_1e.push({field:_20.name,name:_21,width:_20.width?egl.toPX(_20.width):"100px"});}}return _1e;},"addBehaviors":function(_22,_23,_24){var _25=[].appendAll(this.dojoWidget.domNode.getElementsByTagName(_23));for(var n=0;n<_22.length;n++){for(var row=0;row<_24;row++){for(var _26=0;_26<this.columns.length;_26++){var _27=_25[row*this.columns.length+_26];try{_22[n](this,egl.createWidget(_27),this.data[row],row+1,this.columns[_26]);}catch(e){var msg="Error while running behavior for "+(_24?"row="+row:"header")+", column=\""+this.columns[_26].name+"\", cell="+(row*this.columns.length+_26)+" of "+_25.length;if(row){msg+=" row data is: <ul><table cellPadding=3px border=1>";for(var _26=0;_26<this.columns.length;_26++){msg+="<tr><td>"+this.columns[_26].displayName+"</td>";msg+="<td>"+this.data[row][this.columns[_26].name]+"</td></tr>";}msg+="</table></ul>Cancelling the rest of the behaviors for this grid.";}egl.printError(msg,e);return;}}}}},"addRow":function(_28){var _29=(this.createData(_28,this.dojoColumns)).items[0];this.dojoWidget.store.newItem(_29);},"removeRow":function(_2a){_2a--;if(_2a>=1&&_2a<this.dojoWidget.rowCount){this.dojoWidget.selection.deselectAll();this.dojoWidget.selection.setSelected(_2a,true);this.dojoWidget.removeSelectedRows();}},"destroy":function(){}});