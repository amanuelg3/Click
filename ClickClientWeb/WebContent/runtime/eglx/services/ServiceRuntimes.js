egl.STATEFULSESSIONID="egl_statefulsessionid";egl.HTTP_SESSION_ID_KEY="egl.gateway.session.id";egl.HEADER_EGLDEDICATED="EGLDEDICATED";egl.HEADER_RESPONSE_CHARSET="edt.service.response.charset";egl.HEADER_CONTENT_TYPE="Content-Type";egl.HEADER_EGLREST="EGLREST";egl.HEADER_EGLSOAP="EGLSOAP";egl.CUSTOM_HEADER_EGLSOAP="CUSTOMEGLSOAPREQUESTHEADER";egl.CUSTOM_RESPONSE_HEADER_EGLSOAP="CUSTOMEGLSOAPRESPONSEHEADER";egl.CUSTOM_DICT_HEADERS="DictHeaders";egl.SERVICE_TIMEOUT="EGL_TIMEOUT";egl.defineClass("eglx.services","ServiceRT",{"constructor":function(){if(egl.eglx.services.$ServiceRT){return egl.eglx.services.$ServiceRT;}egl.eglx.services.$ServiceRT=this;this.eze$$proxyURL="___proxy";},"setRequestContentTypeHeaderIfNotSet":function(_1){var _2=false;if(_1.headers!=null){_2=egl.containsKey(_1.headers,egl.HEADER_CONTENT_TYPE);}else{_1.headers={};}if(_2==false){var _3=_1.contentType;if(_3===null){_3="text/html";if(_1.encoding===egl.eglx.services.Encoding.JSON){_3="application/json";}else{if(_1.encoding===egl.eglx.services.Encoding.XML){_3="application/xml";}else{if(_1.encoding===egl.eglx.services.Encoding._FORM){_3="application/x-www-form-urlencoded";}}}}if(_1.charset===null){_3+="; charset=UTF-8";}else{_3+="; charset=";_3+=_1.charset;}egl.valueByKey(_1.headers,egl.HEADER_CONTENT_TYPE,_3);}},"isJsonRPCFormat":function(_4){return _4 instanceof egl.eglx.http.HttpRest&&(_4.restType===egl.eglx.rest.ServiceType.EglDedicated||_4.restType===egl.eglx.rest.ServiceType.EglRpc);},"internalInvokeService":function(_5,_6,_7,_8,_9){var _a=null;try{this.setRequestContentTypeHeaderIfNotSet(_5.request);}catch(e){_a=egl.createAnyException("CRRUI3654E",[e]);}if(_5.response.charset!==undefined&&_5.response.charset!==null){egl.valueByKey(_5.request.headers,egl.HEADER_RESPONSE_CHARSET,_5.response.charset);}if(_a!=null){egl.eglx.services.$ServiceRT.callErrorCallback(_8,_9,_a,_5);}else{this.doInvokeAsync(_5,function(_b){var _c=egl.eglx.services.$ServiceRT.isJsonRPCFormat(_b);var _d=null;try{if(_b.response.status>=200&&_b.response.status<=299){var _e=_b.response.headers===null?undefined:egl.findByKey(_b.response.headers,egl.STATEFULSESSIONID);if(_e!=null&&_e!=undefined){var _f=egl.findByKey(_b.response.headers,egl.HTTP_SESSION_ID_KEY);if(_f==undefined){_f=null;}var _10=egl.statefulSessionMap[_b.request.uri];if(_10!=null&&_10!=undefined){if(_e!=_10.sidVal){_10.oldVal=_10.sidVal;_10.sidVal=_e;}else{_10.oldVal=null;}_10.httpSessionId=_f;}else{var _11=new Object();_11.sidVal=_e;_11.oldVal=_e;_11.httpSessionId=_f;egl.statefulSessionMap[_b.request.uri]=_11;}}var _12=_b.response.encoding;if(_12===null||_12===egl.eglx.services.Encoding.USE_CONTENTTYPE){_12=null;var _13;if(_b.response.headers!=null){_13=egl.findByKey(_b.response.headers,egl.HEADER_CONTENT_TYPE);}if(_13!==undefined&&_13!==null){_13=_13.toLowerCase();if(_13.indexOf("application/json")!=-1){_12=egl.eglx.services.Encoding.JSON;}else{if(_13.indexOf("application/xml")!=-1){_12=egl.eglx.services.Encoding.XML;}else{if(_13.indexOf("application/form-urlencoded")!=-1){_12=egl.eglx.services.Encoding._FORM;}}}}if(_12===null){if(_13===undefined){_13="undefined";}else{if(_13===null){_13="null";}}throw egl.createRuntimeException("CRRUI3662E",[_13]);}}if(_12===egl.eglx.services.Encoding.NONE){if(_6.length>0){_6[_6.length-1]=_b.response.body;}}else{if(_12===egl.eglx.services.Encoding.JSON){if(_c){var _14=new egl.eglx.lang.EDictionary();if(_6.length>1){var _15=new Array();for(var idx=0;idx<_6.length;idx++){_15[idx]=new _6[idx];}_14.result=_15;egl.eglx.json.JsonLib.convertFromJSON(_b.response.body,_14,false);_6=_14.result;}else{if(_6.length==1){_14.result=new _6[0];egl.eglx.json.JsonLib.convertFromJSON(_b.response.body,_14,false);_6[0]=_14.result;}}}else{if(_6.length==1){var _16=new _6[0];egl.eglx.json.JsonLib.convertFromJSON(_b.response.body,_16,false);_6[0]=_16;}}}else{if(_12===egl.eglx.services.Encoding.XML){if(_6.length>0){var _16=new _6[_6.length-1];egl.eglx.xml.XmlLib.convertFromXML(_b.response.body,_16);_6[_6.length-1]=_16;}}else{if(_12===egl.eglx.services.Encoding._FORM){_d=egl.createAnyException("CRRUI3656E",[]);}}}}_6[_6.length]=_b;if(_d==null&&_7!=null){if(egl.debugg){egl.debugCallback(_9,_7,_6);}else{try{_7.apply(_9,_6);}catch(e){var msg=egl.getRuntimeMessage("CRRUI1070E",[e.message]);egl.printError(msg,e);throw egl.createRuntimeException("CRRUI1070E",[e.message]);}}}}else{try{_d=egl.eglx.services.$ServiceRT.createExceptionFromJsonRPCError(_b);}catch(jsonError){_d=egl.eglx.services.createServiceInvocationException("CRRUI3653E",[request.uri],egl.eglx.services.$ServiceRT.getServiceKind(_b),_b.response.status,_b.response.statusMessage,_b.response.body);}}}catch(e2){_d=egl.eglx.services.createServiceInvocationException("CRRUI3655E",[e2.message],egl.eglx.services.$ServiceRT.getServiceKind(_b),_b.response.status?_b.response.status:"",_b.response.statusMessage?_b.response.statusMessage:"",_b.response.body?_b.response.body:"");}if(_d!=null){egl.eglx.services.$ServiceRT.callErrorCallback(_8,_9,_d,_b);}},function(_17,_18){egl.eglx.services.$ServiceRT.callErrorCallback(_8,_9,_17,_18);},this);}},"createExceptionFromJsonRPCError":function(_19){var exp=null;var _1a=new egl.eglx.lang.EDictionary();egl.eglx.json.JsonLib.convertFromJSON(_19.response.body,_1a);if(_1a!=null&&_1a.error!=undefined){var _1b=_1a.error.error;var _1c=_1b.name;if(_1c=="eglx.services.ServiceInvocationException"){exp=egl.eglx.services.createServiceInvocationException(_1b.messageID,_1b.message,egl.eglx.services.$ServiceRT.convertToEnum(_1b.source,egl.eglx.services.ServiceKind),_1b.detail1,_1b.detail2,_1b.detail3);}else{exp=egl.eglx.services.createServiceInvocationException(_1b.messageID,_1b.message,egl.eglx.services.$ServiceRT.getServiceKind(_19),_1c);}}else{throw "jsonError";}return exp;},"callErrorCallback":function(_1d,_1e,_1f,_20){try{if(_1d){if(egl.debugg){egl.debugCallback(_1e,_1d,[_1f,_20]);}else{_1d.call(_1e,_1f,_20);}}}catch(e){egl.printError(egl.getRuntimeMessage("CRRUI1072E",[e.message]),e);throw egl.createRuntimeException("CRRUI1072E",[e.message]);}if(!_1d||_1d==null||_1d==undefined){egl.printError(egl.getRuntimeMessage("CRRUI1071E",[_1f.message]),_1f);throw egl.createRuntimeException("CRRUI1071E",[_1f.message]);}},"doInvokeAsync":function(_21,_22,_23,_24){this.doInvokeInternal(_21,function(_25){egl.startNewWork();_22.call(_24,_21);},function(_26,_27){egl.startNewWork();_23.call(_24,_26,_21);},true);},"doInvokeInternal":function(_28,_29,_2a,_2b){if(_28 instanceof egl.eglx.http.HttpRest){if(_28.restType===egl.eglx.rest.ServiceType.EglDedicated){egl.valueByKey(_28.request.headers,egl.HEADER_EGLDEDICATED,"true");}}var _2c=new egl.eglx.lang.EDictionary();_2c.uri=_28.request.uri;_2c.headers=_28.request.headers;_2c.body=_28.request.body;_2c.method=_28.request.method;var _2d=egl.eglx.json.JsonLib.convertToJSON(_2c);var xhr=egl.newXMLHttpRequest();var _2e=new Date().getTime();var _2f="/"+egl.contextRoot+"/"+this.eze$$proxyURL;if(egl.contextAware){_2f+=(_2f.indexOf("?")==-1?"?":"&")+"contextKey="+egl.getContextKey();}xhr.onreadystatechange=function(){if(xhr.readyState==4){var _30=null;try{egl.enter("Response for "+_28.request.uri,{eze$$typename:"RUI Runtime"});if(xhr.status>=200&&xhr.status<=299){try{egl.enter("Parse JSON ("+xhr.responseText.length+" bytes) from "+_28.request.uri,{eze$$typename:"RUI Runtime"});var _31=new egl.eglx.http.Response();egl.eglx.json.JsonLib.convertFromJSON(xhr.responseText,_31);_28.response.body=_31.body;_28.response.status=_31.status;_28.response.statusMessage=_31.statusMessage;_28.response.headers=_31.headers;}finally{egl.leave();}if(_28.response!=null){try{egl.enter("Handling callback for "+_28.request.uri,{eze$$typename:"RUI Runtime"});egl.eglx.services.$ServiceRT.runCallback(_29,_28,_2e);}finally{egl.leave();}}else{_30=egl.eglx.services.createServiceInvocationException("CRRUI3659E",[xhr.responseText],egl.eglx.services.$ServiceRT.getServiceKind(_28),xhr.status,xhr.statusMessage);}}else{_28.response.status=xhr.status||404;_28.response.statusMessage=xhr.statusText;_28.response.body=xhr.responseText;try{_30=egl.eglx.services.$ServiceRT.createExceptionFromJsonRPCError(_28);}catch(jsonError){if(_28.response.status==404){_30=egl.eglx.services.createServiceInvocationException("CRRUI3657E",[_2f],egl.eglx.services.$ServiceRT.getServiceKind(_28),_28.response.status,_28.response.statusMessage,xhr.responseText);}else{_30=egl.eglx.services.createServiceInvocationException("CRRUI3658E",[_2f,_28.request.uri],egl.eglx.services.$ServiceRT.getServiceKind(_28),_28.response.status,_28.response.statusMessage,xhr.responseText);}}}}catch(e){_30=egl.eglx.services.createServiceInvocationException("CRRUI3660E",[_28.request.uri,e.message],egl.eglx.services.$ServiceRT.getServiceKind(_28),xhr.status,xhr.statusMessage,xhr.responseText);}finally{xhr.onreadystatechange=egl.emptyStateChangeFunction;egl.leave();}if(_30!=null){egl.eglx.services.$ServiceRT.runErrorCallback(_2a,_30,_28);}}};if(egl.eze$$SetProxyAuth==true){xhr.open("POST",_2f,_2b,egl.eglx.services.$ServiceLib.eze$$proxyUser,egl.eglx.services.$ServiceLib.eze$$proxyPwd);egl.eze$$SetProxyAuth=false;}else{xhr.open("POST",_2f,_2b);}xhr.setRequestHeader("Content-Length",_2d.length);xhr.setRequestHeader(egl.HEADER_CONTENT_TYPE,"application/jsonrequest;charset=UTF-8");xhr.send(_2d);},"runCallback":function(_32,_33,_34){if(egl.debug){egl.enter("<font color=darkgreen>after&nbsp;"+(_34?(new Date().getTime()-_34):0)+"ms,&nbsp;handle&nbsp;service&nbsp;response&nbsp;for&nbsp;"+_33.request.uri+"</font>",this,[]);}try{_32(_33);}finally{if(egl.debug){egl.leave("service&nbsp;response&nbsp;for&nbsp;"+_33.request.uri,this,[]);}}},"runErrorCallback":function(_35,_36,_37){if(_35){_35(_36,_37);}else{throw egl.createRuntimeException("CRRUI1071E",[_37.request.uri]);}},"encodeResquestBody":function(_38,_39){if(_38.body===null){if(_38.method===egl.eglx.http.HttpMethod._Get||_38.method===egl.eglx.http.HttpMethod._DELETE){_38.body=egl.toString(_39);}else{if(_39){if(_38.encoding===egl.eglx.services.Encoding.JSON){_38.body=egl.eglx.json.toJSONString(_39);}else{if(_38.encoding===egl.eglx.services.Encoding.XML){_38.body=egl.eglx.xml.XmlLib.convertToXML(_39);}else{if(_38.encoding===egl.eglx.services.Encoding._FORM){_38.body=egl.eglx.http.HttpLib.convertToFormData(_39);}else{if(_38.encoding===egl.eglx.services.Encoding.NONE){_38.body=_39;}}}}}}}},"getServiceKind":function(_3a){if(_3a instanceof egl.eglx.http.HttpRest){if(_3a.restType===egl.eglx.rest.ServiceType.EglDedicated){return egl.eglx.services.ServiceKind.EGL;}else{return egl.eglx.services.ServiceKind.REST;}}},"serviceKind":function(sie){switch(sie.source){case egl.eglx.services.ServiceKind.WEB:return "WEB";case egl.eglx.services.ServiceKind.NATIVE:return "NATIVE";case egl.eglx.services.ServiceKind.EGL:return "EGL";case egl.eglx.services.ServiceKind.REST:return "REST";default:return "unknown";}},"convertToEnum":function(_3b,_3c){if(typeof _3b==="string"){_3b=egl.eglx.lang.EInt32.fromEString(_3b);}for(var _3d in _3c){if(_3c[_3d] instanceof egl.eglx.lang.Enumeration&&_3c[_3d].value==_3b){return _3c[_3d];}}return undefined;}});egl.emptyStateChangeFunction=function(){};new egl.eglx.services.ServiceRT();egl.statefulSessionMap=new Object();egl.eze$$SetProxyAuth=null;egl.eglx.services.createServiceInvocationException=function(_3e,_3f){if(typeof (_3f)!="string"){_3f=egl.getRuntimeMessage(_3e,_3f);}egl.exceptionThrown=true;var _40=new Array();_40.push(["messageID",_3e||""]);_40.push(["message",_3f||""]);var exp={};if(arguments[2] instanceof egl.eglx.services.ServiceKind){exp["source"]=arguments[2];}else{exp["source"]=undefined;}var _41="";if(arguments[3]){_41=arguments[3]+"";}var _42="";if(arguments[4]){_42=arguments[4]+"";}var _43="";if(arguments[5]){_43=arguments[5]+"";}exp["detail1"]=_41;exp["detail2"]=_42;exp["detail3"]=_43;var _44=new egl.eglx.services.ServiceInvocationException(_40);_44.ezeCopy(exp);return _44;};